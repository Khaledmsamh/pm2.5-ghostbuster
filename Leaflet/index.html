<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Festival Map</title>
    <link rel="stylesheet" href="/leaflet.css" />
    <script src="/leaflet.js"></script>
	
	<! -- Customized -->
	<link rel="stylesheet" href="css/customize.css" />
	
	
	<! -- ExtraMakers -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" />
	<link rel="stylesheet" href="css/leaflet.extra-markers.min.css">
	

	<! -- Full Screen -->
	<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>
	<link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css' rel='stylesheet' />
	
	<! -- ExtraMakers -->
	<script src="js/leaflet.extra-markers.min.js"></script>
	
	<! -- Markercluster https://github.com/Leaflet/Leaflet.markercluster -->
	<script src="js/leaflet.markercluster.js"></script>
	<link rel="stylesheet" href="css/MarkerCluster.css">
	<link rel="stylesheet" href="css/MarkerCluster.Default.css">
	
	<!-- Load jQuery and PapaParse to read data from a CSV file -->
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
	
	<!-- Sidebar -->
	<link rel="stylesheet" href="css/L.Control.Sidebar.css" />
	<script src="js/L.Control.Sidebar.js"></script>
	
	<!-- subgroup -->
	<script src="js/leaflet.featuregroup.subgroup.js"></script>
	
	<!-- heatmap -->	
	<script src="js/leaflet-heat.js"></script>
	
	<!-- d3 color scale -->	
	<script src="js/d3.v7.min.js"></script>
	
	<!-- GPS Location -->	
	<link rel="stylesheet" href="css/L.Control.Locate.min.css" />
	<script src="js/L.Control.Locate.min.js" charset="utf-8"></script>

</head>
<body>
    <!-- <div id="map" style="height: 800px;"></div> -->
    <div id="map" style="height: 100vh;"></div>
	
	<div id="sidebar">
	<h3 style="color:red;">Current number of fire spots around Thailand: </h3><h2 style="color:red;"><span id="firespot"></span> !</h2>
	<p></p>
	<h3>Welcome to</h3><h2 style="color:blue;">Baan Noorg</h2><h1>Baan Noorg</h1><p>Baan Noorg Collaborative Arts and Culture is a not for profit, artist run initiative, established in 2011, in a Tai Yuan (ไทยวน) civilization town of Ratchaburi province, Thailand. Its independent project is organized by artists with a trans-disciplinary background between art, theory & diverse sciences with the aim to support and boost artistic experience and community development.</p><img src="images/bng.png" alt="Baan Noorg">
	</div>
	
    <script>
		
		/////////////////
		// MAP //
		
		// OSM
		// var osm = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
			// maxZoom: 21,
			// attribution: '© OpenStreetMap'
		// });
		

		// var map = L.map('map').setView([13.74126268827169, 99.91452984269866], 17);
        // L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            // attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
			// layers: [osm]
        // }).addTo(map);
		

		// ESRI
		var map = L.map('map').setView([13.74126268827169, 99.91452984269866], 17);
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}.png', {
            attribution: 'Info by <a href="http://baannoorg.org/" target="_blank">Baan Noorg</a>. Base Map of <a href="http://www.esri.com/software/arcgis/arcgisonline/maps/maps-and-map-layers" target="_blank">Esri</a>. Map powered by Leaflet'
        }).addTo(map);
		map.attributionControl.setPrefix('Baannoorg biennial 2023')
		
		//////////////////////
		// Marker Cluster 1 //
		var mcg  = L.markerClusterGroup(),
		
		//////////////////////
		// Subgroup //
		// group_nonart = L.markerClusterGroup(), // Could be any other Layer Group type.
		// group_art = L.markerClusterGroup(), // Could be any other Layer Group type.
		// group_environment = L.markerClusterGroup(), // Could be any other Layer Group type.
		
		// group_nonart = L.featureGroup(), // Could be any other Layer Group type.
		// group_art = L.featureGroup(), // Could be any other Layer Group type.
		// group_environment = L.featureGroup(), // Could be any other Layer Group type.
		
		// This is where the magic happens!
		subgroup_art = L.featureGroup.subGroup(mcg),
		subgroup_restaurant = L.featureGroup.subGroup(mcg),
		subgroup_coffe = L.featureGroup.subGroup(mcg),
		subgroup_shop = L.featureGroup.subGroup(mcg),
		subgroup_place = L.featureGroup.subGroup(mcg),
		subgroup_fire = L.featureGroup.subGroup(mcg),
		subgroup_fireheatmap = L.featureGroup.subGroup(mcg),
		subgroup_pm25point = L.featureGroup.subGroup(mcg);
		
		mcg.addTo(map);
		// subgroup_restaurant.addTo(group_nonart);
		// subgroup_coffe.addTo(group_nonart);
		
		// markerClusterGroup.addLayer(group_art);
		// markerClusterGroup.addLayer(group_nonart);
		// markerClusterGroup.addLayer(group_environment);
		// markerClusterGroup.addLayer(subgroup_pm25point);
		// markerClusterGroup.addTo(map);

		//control = L.control.layers(null, null, { collapsed: false }).addTo(map);
		control = L.control.layers(null, null, { collapsed: true }).addTo(map);
		
		// control.addOverlay(group_art, 'Art Group');
		// control.addOverlay(group_nonart, 'Non-Art Group');
		
		control.addOverlay(subgroup_art, '<i class="fa fa-spinner"></i> Art');
		control.addOverlay(subgroup_restaurant, '<i class="fa fa-utensils"></i> Restaurant');
		control.addOverlay(subgroup_coffe, '<i class="fa fa-coffee"></i> Coffe');
		control.addOverlay(subgroup_place, '<i class="fa fa-building"></i> Place');
		control.addOverlay(subgroup_shop, '<i class="fa fa-shopping-bag"></i> Shop');
		control.addOverlay(subgroup_fire, '<i class="fa fa-fire"></i> Live Fire spot (24h)');
		control.addOverlay(subgroup_fireheatmap, '<i class="fa fa-fire"></i> Live Fire impact (24h)');
		control.addOverlay(subgroup_pm25point, 'Live PM2.5');
		// control.addTo(map);

		// group_nonart.addTo(map);
		// group_art.addTo(map);
		subgroup_art.addTo(map); // Adding to map now adds all child layers into the parent group.
		subgroup_restaurant.addTo(map); // Adding to map now adds all child layers into the parent group.
		subgroup_coffe.addTo(map); // Adding to map now adds all child layers into the parent group.
		subgroup_place.addTo(map); // Adding to map now adds all child layers into the parent group.
		subgroup_shop.addTo(map); // Adding to map now adds all child layers into the parent group.



		
		/////////////////
		// marker //

		// ICON //
		var bngIcon = L.icon({
			iconUrl: 'images/bng.png',
			iconSize: [50, 50],
			// shadowSize:   [100, 100], // size of the shadow
			iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
			//shadowAnchor: [4, 62],  // the same for the shadow
			popupAnchor: [0, -38]
		});
		
		const fireIcon = L.divIcon({
			html: '<i class="fa fa-fire" style="color: red"></i>',
			//fa-solid fa-fire 
			iconSize: [20, 20],
			className: 'myDivIcon'
		});
		
		// Creates a red marker with the coffee icon
		var fireMarker = L.ExtraMarkers.icon({
			shape: 'circle',
			icon: 'fa-solid fa-fire',
			markerColor: 'red',
			prefix: 'fa'
		})
		
		var coffeMarker = L.ExtraMarkers.icon({
			shape: 'circle',
			icon: 'fa-coffee',
			markerColor: 'orange',
			prefix: 'fa'
		});
		
		var restaurantMarker = L.ExtraMarkers.icon({
			shape: 'circle',
			icon: 'fa-utensils ',
			markerColor: 'orange',
			prefix: 'fa'
		});
		
		var artMarker = L.ExtraMarkers.icon({
			shape: 'penta',
			markerColor: 'violet',
			prefix: 'fa',
			icon: 'fa-spinner',
			iconColor: '#fff',
			iconRotate: 0,
			extraClasses: 'fa-spin',
			number: '',
			// svg: true
		});
		
		var placeMarker = L.ExtraMarkers.icon({
			shape: 'circle',
			markerColor: 'black',
			prefix: 'icon',
			icon: 'fa fa-building',
			iconColor: '#fff',
			iconRotate: 0,
			extraClasses: '',
			number: ''
			// svg: true
		});
		
		var shopMarker = L.ExtraMarkers.icon({
			shape: 'square',
			markerColor: 'blue',
			prefix: 'icon',
			icon: 'fa fa-shopping-bag',
			iconColor: '#fff',
			iconRotate: 0,
			extraClasses: '',
			number: ''
			// svg: true
		});

		//// Create Markers ///
		var markerlist = [
		  {
			lat: 13.738499264414234,
			lng: 99.91441176863576,
			group: subgroup_restaurant,
			icon: restaurantMarker,
			content: '<h2>ป๋าหรั่งหมูกะทะแอนด์ไมโลดิบ</h2><p>ป๋าหรั่ง</p>'
		  },
		  {
			lat: 13.73840521574008,
			lng: 99.91674592338283,
			group: subgroup_place,
			icon: placeMarker,
			content: '<h2>Wat Nong Pho Community School</h2></h3>โรงเรียนชุมชนวัดหนองโพ</h3><p>Marker 3 content</p>'
		  },
		  {
			lat: 13.741348304933565,
			lng: 99.91366504425268,
			group: subgroup_art,
			icon: artMarker,
			content: '<h2>Art1</h2><p>Marker 4 content</p>'
		  },
		  {
			lat: 13.738683869595425, 
			lng: 99.91533643577199,
			group: subgroup_place,
			icon: placeMarker,
			content: '<h2>จุดตรวจ ป้อมยาม หนองโพ</h2><p>content</p>'
		  },
		  {
			lat: 13.739445982113027, 
			lng: 99.91588308526767,
			group: subgroup_shop,
			icon: shopMarker,
			content: '<h2>Chit Wetchaphan Pharmacy</h2><h3>จิตเวชภัณฑ์ขายยา</h3><p>content</p>'
		  },
		  {
			lat: 13.740627173552992, 
			lng: 99.91596916888057,
			group: subgroup_shop,
			icon: shopMarker,
			content: '<h2>เภสัชกรสว่างจิต</h2><p>content</p>'
		  },
		  {
			lat: 13.73652174296916,
			lng: 99.91885081306123,
			group: subgroup_place,
			icon: placeMarker,
			content: '<h2>Nong Pho Wittaya School</h2><h3>โรงเรียนหนองโพวิทยา</h2><p>content</p>'
		  },
		  {
			lat: 13.737224420332044,
			lng: 99.91321952655278,
			group: subgroup_shop,
			icon: shopMarker,
			content: '<h2>7-Eleven สาขา ชุมชนหนองโพ (17831)</h2><p>content</p>'
		  },
		  {
			lat: 13.740062043116694, 
			lng: 99.91691997073384,
			group: subgroup_shop,
			icon: shopMarker,
			content: '<h2>7-Eleven สาขา หนองโพ (07690)</h2><p>content</p>'
		  },
		  {
			lat: 13.73990253965249,
			lng: 99.91543902655296,
			group: subgroup_restaurant,
			icon: restaurantMarker,
			content: '<h2>Saifon milk & icecream</h2><h3>ร้านสายฝน</h3><p>content</p>'
		  },
		  {
			lat: 13.740469104510453, 
			lng: 99.91553078793181,
			group: subgroup_place,
			icon: placeMarker,
			content: '<h2>The clinic\'s doctors Thada</h2><h3>คลีนิคมหาสนุก หมอธาดา</h3><p>content</p>'
		  },
		  {
			lat: 13.740622873556685, 
			lng: 99.91711095724244,
			group: subgroup_restaurant,
			icon: restaurantMarker,
			content: '<h2>ร้านหูกวาง</h2><p>content</p>'
		  },
		  {
			lat: 13.74029918288717, 
			lng: 99.91682845353587,
			group: subgroup_restaurant,
			icon: restaurantMarker,
			content: '<h2>ครัวต้นหอม หนองโพ</h2><p>content</p>'
		  },
		  {
			lat: 13.74449546482519, 
			lng: 99.91951391932471,
			group: subgroup_restaurant,
			icon: restaurantMarker,
			content: '<h2>ร้านเตาดินจิ้มจุ่ม หนองโพ หนองโพ</h2><p>content</p>'
		  },
		  {
			lat: 13.744931307575762, 
			lng: 99.91726358422562,
			group: subgroup_coffe,
			icon: coffeMarker,
			content: '<h2>บ้านคุณทวด กาแฟสด</h2><p>content</p>'
		  },
		  {
			lat: 13.744654886285547, 
			lng: 99.91960232886035,
			group: subgroup_restaurant,
			icon: restaurantMarker,
			content: '<h2>MINIMUM</h2><p>content</p>'
		  }
		];
		
		//var marker = L.marker([13.74126268827169, 99.91452984269866]).addTo(map);		
		var marker_baannorg = L.marker([13.74126268827169, 99.91452984269866], {icon: bngIcon}).addTo(map).on('click', function() {
			  sidebar.setContent('<h2>Baan Noorg Collaborative Arts and Culture</h2><p>Baan Noorg is a non-profit artist-run initiative, a fundament strategy for community development and an artistic practice service-providing program located in Nongpho district, Ratchaburi, found by jiandyin since 2011. Baan Noorg runs alternative interdisciplinary art program for developing contemporary art and cultural production for local and global community. It functions as an alternative learning platform for analyzing, discussing and debating theoretically and practically toward social condition and community as case study for exploring, researching and developing community engagement, social practice, cultural and contemporary art practice among artists, researchers, curators, educators from various fields.  The expected outcome is to find out the possibilities of living together and achieving better community. Baan Noorg’s programs and activities are partly funded by government/non-government institutions and self-fund.</p><img src="images/BaanNoorg_Atmosphere.jpg" alt="BaanNoorg">');
			  sidebar.show();
		  })
		
		// Add markers
		markerlist.forEach(function(markerlist) {
			L.marker([markerlist.lat, markerlist.lng], { icon: markerlist.icon })
			// .bindPopup(markerlist.content)
			.addTo(map)
			.on('click', function() {
			  sidebar.setContent(markerlist.content);
			  sidebar.show();
			}).addTo(markerlist.group);
			//marker.addTo(markerlist.icon == quarterCount ? group1 : i < quarterCount * 2 ? group2 : i < quarterCount * 3 ? group3 : group4);
		});


		// var restaurant1 = L.marker([13.738499264414234, 99.91441176863576], {icon: restaurantMarker}).addTo(map).bindPopup("ป๋าหรั่งหมูกะทะแอนด์ไมโลดิบ");
			// restaurant2 = L.marker([13.745020301425022, 99.91714710317994], {icon: coffeMarker}).addTo(map).bindPopup("บ้านคุณทวด กาแฟสด");
			// institute1 = L.marker([13.73840521574008, 99.91674592338283], {icon: artInstitute}).addTo(map).bindPopup("Wat Nong Pho Community School โรงเรียนชุมชนวัดหนองโพ");
			// art1 = L.marker([13.741348304933565, 99.91366504425268], {icon: artMarker}).addTo(map).bindPopup("Art1");
		
		// //// Group on marker cluster show ////
		// //markerclustershow.addLayer(marker_baannorg);
		// markerclustershow.addLayer(restaurant1);
		// markerclustershow.addLayer(restaurant2);
		// markerclustershow.addLayer(institute1);
		// markerclustershow.addLayer(art1);
		
		// //// Group on group too bar ////
		// var food = L.layerGroup([restaurant1, restaurant2]);
		// var institute = L.layerGroup([institute1]);
		// var art = L.layerGroup([art1]);
		
		
		/////////////////
		// Full Screen //
		// or, add to an existing map:
		map.addControl(new L.Control.Fullscreen());
		
		//map.isFullscreen() // Is the map fullscreen?
		//map.toggleFullscreen() // Either go fullscreen, or cancel the existing fullscreen.

		// `fullscreenchange` Event that's fired when entering or exiting fullscreen.
		map.on('fullscreenchange', function () {
			if (map.isFullscreen()) {
				console.log('entered fullscreen');
			} else {
				console.log('exited fullscreen');
			}
		});
		
		///////////////////
		// Group Cluster //
		// var streets = L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoid2VyYXBvbCIsImEiOiJjbGZuM2FjM2QwaGZoM3BtbW83bXhuY3R5In0.pxWdDSBQ3o4ZQx-QC7g-_w', {id: 'mapbox/streets-v11', tileSize: 512, zoomOffset: -1, attribution: '© <a href="https://www.mapbox.com/feedback/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'});

		// var baseMaps = {
			// "OpenStreetMap": osm,
			// "Mapbox Streets": streets
		// };

		// var overlayMaps = {
			// "Food": food,
			// "Art": art,
			// "Institute": institute
		// };
		

		// var baseMaps = {
			// //"<span style='color: gray'>Grayscale</span>": grayscale(1),
			// "Streets": streets
		// };
		// var satellite = L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoid2VyYXBvbCIsImEiOiJjbGZuM2FjM2QwaGZoM3BtbW83bXhuY3R5In0.pxWdDSBQ3o4ZQx-QC7g-_w', {id: 'MapID', tileSize: 512, zoomOffset: -1, attribution: '© <a href="https://www.mapbox.com/feedback/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'});

		// var layerControl = L.control.layers(baseMaps, overlayMaps).addTo(map);
		
		// layerControl.addBaseLayer(satellite, "Satellite");
		//layerControl.addOverlay(food, "Food");
		//layerControl.addOverlay(art, "Art");

		
		///////////////
		// CSV from firepos
		//////////////
		data_array= []; //create data for heatmap before filling 
		
		// Read markers data from data.csv
		$.get('csv/fire.csv', function(csvString) {

		// Use PapaParse to convert string to array of objects
		var data = Papa.parse(csvString, {header: true, dynamicTyping: true}).data;
		var dataCount = data.length;

		// For each row in data, create a marker and add it to the map
		// For each row, columns `Latitude`, `Longitude`, and `Title` are required
		for (var i in data) {
			var row = data[i];

			var firepos = L.marker([row.latitude, row.longitude], {
			opacity: 0.5,
			icon: fireIcon
			//icon: fireMarker
			}).bindPopup(row.brightness.toFixed(0));
			// }).bindPopup("Test");
			// firepos.addTo(map);
			
			// Add to control layer
			subgroup_fire.addLayer(firepos);
			
			//firepos.addTo(subgroup_fire);
			// markerclustershow.addLayer(firepos);
			data_array[i] = [row.latitude, row.longitude, row.brightness]; // if values are marked as string in the object else:
			//  data_array[i] = [data[i].lat,data[i].lon,data[i].val];
		}
		
		document.getElementById("firespot").innerHTML = dataCount;
		});
		
		// Show the number of fire spots
		// console.log(data_array);
		
	

		//////////////////////
		// Sidebar //
		var sidebar = L.control.sidebar('sidebar',{
			closeButton: true,
			position: 'left',
			autoPan: true,
			responsive: true,
		}).addTo(map);
        map.addControl(sidebar);
		
		// Time to show at the begining
        setTimeout(function () {
            sidebar.show();
        }, 500);
		
        map.on('click', function () {
            sidebar.hide();
        })

		///////////////
		// Display GeoJSON of PM2.5
		///////////////
		// add GeoJSON layer
        var geojsonLayer = L.geoJSON(null, {
            pointToLayer: function(feature, latlng) {
                return L.circleMarker(latlng, {
					fillColor: pm25colorScale(feature.properties.pm25),
					fillOpacity: 0.8,
					color: '#000000',
					weight: 0.5
				});
            },
            onEachFeature: function(feature, layer) {
                layer.bindPopup("Device ID: " + feature.properties.device_id + "<br>" +
                                "PM2.5: " + feature.properties.pm25 + "<br>" +
                                "Time: " + feature.properties.time);
            }
        //}).addTo(map).addTo(subgroup_pm25point);
		}).addTo(map).addTo(mcg).addTo(subgroup_pm25point);
		


		// create a color scale using d3
		var pm25colorScale = d3.scaleLinear()
			.domain([0, 12.1, 35.5, 55.5, 150.5, 250.5])
			.range(["#00FF00", "#84ff00", "#FFFF00", "#FF0000", "#800080"]);
	
        // load GeoJSON data from file
        fetch("gj/pm25gps.geojson")
            .then(response => response.json())
            .then(data => {
                geojsonLayer.addData(data);
                //map.fitBounds(geojsonLayer.getBounds());
				subgroup_pm25point.addLayer(geojsonLayer); // Add geojsonLayer to subgroup_environment
				subgroup_pm25point.addTo(map); // Add group_environment to map			

            });
		
		//////////////////////
		// Heatmap //
		var heatmap = L.heatLayer(data_array,{
		  radius: 15,
		  blur: 25, 
		  maxZoom: 6
		});
		//addTo(map).addTo(subgroup_fireheatmap);
		//console.log(heatmap);
		
		
		////////////////////////
		// Add to control layer
		heatmap.addTo(map);
		mcg.addLayer(heatmap);
		//heatmap.addTo(mcg);
		subgroup_fireheatmap.addLayer(heatmap);
		mcg.addLayer(subgroup_fireheatmap);
		
		
		// Add remove cluster
		// document.getElementById("add").addEventListener("click", function () {
		  // map.addLayer(mcg);
		// });

		// document.getElementById("remove").addEventListener("click", function () {
		  // map.removeLayer(mcg);
		// });
		
		
		//////////////////////
		// Add Subgroup 2 //		
		//subgroup_fire.addTo(map); // Adding to map now adds all child layers into the parent group.
		subgroup_fireheatmap.addTo(map); // Adding to map now adds all child layers into the parent group.
		
		


		//////////////////////
		// GPS current locaiton //
		var lc = L.control
		  .locate({
			position: "topleft",
			strings: {
			  title: "Show me where I am now!"
			}
		  })
		  .addTo(map);
		  
		  
    </script>
</body>

</html>
